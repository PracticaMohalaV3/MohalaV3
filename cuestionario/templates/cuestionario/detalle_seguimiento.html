{% extends "cuestionario/base.html" %}

{% block title %}Detalle de Evaluaci√≥n - {{ trabajador.nombre }}{% endblock %}

{% block content %}
<section>
    <header>
        <a href="{% url 'seguimiento_admin' %}" class="button small">‚Üê Volver a Seguimiento</a>
        
        <h2 style="margin-top: 1em;">Detalle de Evaluaci√≥n</h2>
        <p>Colaborador: <strong>{{ trabajador.nombre }} {{ trabajador.apellido_paterno }} {{ trabajador.apellido_materno }}</strong><br>
        Cargo: {{ trabajador.cargo.nombre_cargo }} | Nivel: <em>{{ trabajador.nivel_jerarquico.nombre_nivel_jerarquico }}</em><br>
        Jefatura Directa: 
        {% if trabajador.id_jefe_directo %}
            <strong>{{ trabajador.id_jefe_directo.nombre }} {{ trabajador.id_jefe_directo.apellido_paterno }} {{ trabajador.id_jefe_directo.apellido_materno }}</strong>
        {% else %}
            <em>N/A</em>
        {% endif %}
        </p>
    </header>

    <div style="background: rgba(255,255,255,0.05); padding: 1.5em; border-radius: 8px; margin-bottom: 2em;">
        <div class="row">
            <div class="col-6">
                <strong>Autoevaluaci√≥n finalizada:</strong><br>
                {% if timestamp_auto %}
                    {{ timestamp_auto|date:"d/m/Y H:i" }}
                {% else %}
                    <span style="opacity: 0.5;">Pendiente</span>
                {% endif %}
            </div>
            <div class="col-6">
                <strong>Evaluaci√≥n Jefatura finalizada:</strong><br>
                {% if timestamp_jefe %}
                    {{ timestamp_jefe|date:"d/m/Y H:i" }}
                {% else %}
                    <span style="opacity: 0.5;">N/A o Pendiente</span>
                {% endif %}
            </div>
        </div>
    </div>

    <h3 style="color: #51ff85; margin-top: 2em;">Dimensi√≥n: Organizacional</h3>
    <div class="table-wrapper">
        <table class="alt">
            <thead>
                <tr>
                    <th style="width: 8%;">C√≥digo</th>
                    <th style="width: 40%;">Competencia / Indicador</th>
                    <th style="text-align: center; width: 13%;">AutoEv</th>
                    <th style="text-align: center; width: 13%;">Ev. Jefe</th>
                    <th style="text-align: center; width: 13%;">Diferencia</th>
                </tr>
            </thead>
            <tbody>
                {% for r in resultados_organizacionales %}
                <tr>
                    <td style="text-align: center;">
                        <strong>{{ r.codigo_excel.codigo_excel }}</strong>
                    </td>
                    <td>
                        <span style="color: #51ff85; font-weight: bold;">
                            {{ r.competencia.nombre_competencia }}
                        </span><br>
                        <small style="opacity: 0.7; display: block; margin-top: 4px;">{{ r.codigo_excel.texto }}</small>
                    </td>
                    <td style="text-align: center; vertical-align: middle;">
                        <span style="background: rgba(81, 255, 133, 0.2); color: #51ff85; padding: 0.4em 0.8em; border-radius: 15px; font-weight: bold;">
                            {{ r.puntaje_autoev }}
                        </span>
                    </td>
                    <td style="text-align: center; vertical-align: middle;">
                        {% if r.puntaje_jefe > 0 %}
                            <span style="background: rgba(33, 150, 243, 0.2); color: #2196F3; padding: 0.4em 0.8em; border-radius: 15px; font-weight: bold;">
                                {{ r.puntaje_jefe }}
                            </span>
                        {% else %}
                            <span style="opacity: 0.3;">N/A</span>
                        {% endif %}
                    </td>
                    <td style="text-align: center; vertical-align: middle;">
                        <span style="
                            {% if r.diferencia > 0 %}background: rgba(81, 255, 133, 0.2); color: #51ff85;
                            {% elif r.diferencia < 0 %}background: rgba(255, 81, 81, 0.2); color: #ff5151;
                            {% else %}background: rgba(255, 255, 255, 0.1); color: #fff;
                            {% endif %}
                            padding: 0.4em 0.8em; border-radius: 15px; font-weight: bold;">
                            {% if r.diferencia > 0 %}+{% endif %}{{ r.diferencia|floatformat:0 }}
                        </span>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" style="text-align: center; padding: 2em; opacity: 0.5;">
                        No hay datos organizacionales disponibles.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <h3 style="color: #2196F3; margin-top: 3em;">Dimensi√≥n: Funcional</h3>
    <div class="table-wrapper">
        <table class="alt">
            <thead>
                <tr>
                    <th style="width: 8%;">C√≥digo</th>
                    <th style="width: 40%;">Competencia / Indicador</th>
                    <th style="text-align: center; width: 13%;">AutoEv</th>
                    <th style="text-align: center; width: 13%;">Ev. Jefe</th>
                    <th style="text-align: center; width: 13%;">Diferencia</th>
                </tr>
            </thead>
            <tbody>
                {% for r in resultados_funcionales %}
                <tr>
                    <td style="text-align: center;">
                        <strong>{{ r.codigo_excel.codigo_excel }}</strong>
                    </td>
                    <td>
                        <span style="color: #2196F3; font-weight: bold;">
                            {{ r.competencia.nombre_competencia }}
                        </span><br>
                        <small style="opacity: 0.7; display: block; margin-top: 4px;">{{ r.codigo_excel.texto }}</small>
                    </td>
                    <td style="text-align: center; vertical-align: middle;">
                        <span style="background: rgba(81, 255, 133, 0.2); color: #51ff85; padding: 0.4em 0.8em; border-radius: 15px; font-weight: bold;">
                            {{ r.puntaje_autoev }}
                        </span>
                    </td>
                    <td style="text-align: center; vertical-align: middle;">
                        {% if r.puntaje_jefe > 0 %}
                            <span style="background: rgba(33, 150, 243, 0.2); color: #2196F3; padding: 0.4em 0.8em; border-radius: 15px; font-weight: bold;">
                                {{ r.puntaje_jefe }}
                            </span>
                        {% else %}
                            <span style="opacity: 0.3;">N/A</span>
                        {% endif %}
                    </td>
                    <td style="text-align: center; vertical-align: middle;">
                        <span style="
                            {% if r.diferencia > 0 %}background: rgba(81, 255, 133, 0.2); color: #51ff85;
                            {% elif r.diferencia < 0 %}background: rgba(255, 81, 81, 0.2); color: #ff5151;
                            {% else %}background: rgba(255, 255, 255, 0.1); color: #fff;
                            {% endif %}
                            padding: 0.4em 0.8em; border-radius: 15px; font-weight: bold;">
                            {% if r.diferencia > 0 %}+{% endif %}{{ r.diferencia|floatformat:0 }}
                        </span>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" style="text-align: center; padding: 2em; opacity: 0.5;">
                        No hay datos funcionales disponibles.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- BOTONES PARA REPORTES -->
    <div style="text-align: center; margin-top: 3em;">
        <a href="{% url 'generar_pdf_detalle' trabajador.id_trabajador %}" 
           class="button primary large" 
           target="_blank"
           style="margin-right: 1em;">
            üìÑ Imprimir Informe
        </a>
        
        <a href="{% url 'generar_excel_detalle' trabajador.id_trabajador %}" 
           class="button primary large">
            üìä Descargar Reporte Excel
        </a>
    </div>

</section>
{% endblock %}